# 防災士研修センター会場管理システム 非機能要件定義書

## 1. 文書概要

### 1.1 文書の目的
本文書は、防災士研修センター会場管理システムの非機能要件について定義する。
機能要件以外のシステム品質特性（性能、信頼性、セキュリティ等）に関する要求事項を明確にする。

### 1.2 対象システム
- システム名：防災士研修センター会場管理システム
- システムID：VMS-001
- 適用フェーズ：全開発フェーズ（フェーズ1-3）

### 1.3 関連文書
- 要件定義書（requirement_definition.md）
- 機能要件定義書（functional_requirements.md）
- システムアーキテクチャ（/docs/technical/architecture.md）

## 2. システム前提条件

### 2.1 実装フェーズ
- **フェーズ1**：JSONプロトタイプ（React frontend のみ）
- **フェーズ2**：バックエンド統合（Python FastAPI + SQLite）
- **フェーズ3**：本番環境（PostgreSQL + Replit）

### 2.2 技術スタック
- フロントエンド：React 18+ (100% Atomic Design)
- バックエンド：Python 3.11+ FastAPI
- データベース：SQLite（開発）/ PostgreSQL（本番）
- デプロイ：Replit（将来AWS移行）
- AI連携：OpenAI API (GPT-4)

### 2.3 利用者想定
- 同時利用者数：2-3名
- 主要利用者：防災士研修センタースタッフ
- 利用環境：オフィス内デスクトップ・ラップトップ

## 3. 性能要件

### 3.1 レスポンス性能要件

#### 3.1.1 画面表示性能
| 画面種別 | 目標時間 | 許容時間 | 備考 |
|----------|----------|----------|------|
| ログイン画面 | 1秒以内 | 2秒以内 | 初回表示 |
| ダッシュボード | 2秒以内 | 3秒以内 | 統計情報含む |
| 会場一覧（20件） | 2秒以内 | 3秒以内 | ページネーション込み |
| 会場詳細表示 | 1.5秒以内 | 2.5秒以内 | 単一会場情報 |
| 会場検索結果 | 3秒以内 | 5秒以内 | 条件検索込み |

#### 3.1.2 データ操作性能
| 操作種別 | 目標時間 | 許容時間 | 備考 |
|----------|----------|----------|------|
| 会場登録 | 2秒以内 | 4秒以内 | バリデーション含む |
| 会場更新 | 2秒以内 | 4秒以内 | 履歴記録含む |
| データ検索 | 3秒以内 | 5秒以内 | 複合条件検索 |
| CSV/Excel出力 | 5秒以内 | 10秒以内 | 100件まで |

#### 3.1.3 AI機能性能
| AI機能 | 目標時間 | 許容時間 | 備考 |
|--------|----------|----------|------|
| テキスト情報抽出 | 10秒以内 | 15秒以内 | OpenAI API依存 |
| 住所正規化 | 3秒以内 | 5秒以内 | 郵便番号API連携 |
| 入力補助・候補表示 | 1秒以内 | 2秒以内 | リアルタイム表示 |

### 3.2 スループット要件

#### 3.2.1 同時接続数
- 最大同時接続数：5名（余裕をもった設定）
- 通常利用想定：2-3名
- ピーク時間帯：平日9:00-18:00

#### 3.2.2 データ処理量
- 1時間あたりの登録・更新：最大50件
- 1日あたりの検索実行：最大200回
- 月間データ増加量：10-20件

### 3.3 リソース使用量

#### 3.3.1 フロントエンド（フェーズ1）
- 初期ロード時間：3秒以内
- メモリ使用量：100MB以下（ブラウザ）
- 対応ブラウザ：Chrome, Firefox, Safari, Edge（各最新版）

#### 3.3.2 バックエンド（フェーズ2以降）
- CPU使用率：平均30%以下、ピーク50%以下
- メモリ使用量：512MB以下
- ディスク使用量：初期10GB、年間増加1GB

#### 3.3.3 データベース
- レスポンス時間：SELECT 100ms以内、INSERT/UPDATE 200ms以内
- 同時接続数：10接続（プール設定）
- データ増加量：年間50MB以下

## 4. 可用性要件

### 4.1 稼働率要件
- 目標稼働率：99.0%以上（年間ダウンタイム87時間以内）
- 営業時間（平日9:00-18:00）稼働率：99.5%以上
- 計画停止：月1回、最大2時間（土日実施）

### 4.2 障害対応要件
- 障害検知時間：5分以内
- 復旧作業開始：1時間以内
- 障害復旧時間：4時間以内（重大障害）
- データ損失許容範囲：1時間以内のデータ

### 4.3 バックアップ要件
- 自動バックアップ：日次（3:00実行）
- 保存期間：30日間
- リストア時間：2時間以内
- バックアップ対象：全データ＋システム設定

## 5. セキュリティ要件

### 5.1 認証・認可要件

#### 5.1.1 認証方式
- 認証方式：メールアドレス + パスワード
- セッション管理：サーバーサイドセッション
- セッションタイムアウト：2時間（無操作時）
- 自動ログアウト：8時間後

#### 5.1.2 パスワードポリシー
- 最小文字数：8文字以上
- 文字種別：英大文字・小文字・数字・記号のうち3種類以上
- 履歴管理：過去5回分は再使用不可
- 有効期限：90日（推奨）

#### 5.1.3 アクセス制御
- 権限レベル：システム管理者、運営管理者、一般利用者
- 機能別アクセス制御：RBAC（Role-Based Access Control）
- データアクセス制御：行レベルセキュリティ（将来実装）

### 5.2 通信セキュリティ
- プロトコル：HTTPS必須（TLS 1.3以上）
- 証明書：SSL/TLS証明書（Replit提供またはLet's Encrypt）
- HTTP→HTTPS リダイレクト：自動実行

### 5.3 データ保護

#### 5.3.1 暗号化要件
- パスワード：bcrypt（コスト12以上）
- データベース接続：暗号化接続
- 機密データ：AES-256暗号化（将来実装）

#### 5.3.2 個人情報保護
- 個人情報の最小化：必要最小限のデータ収集
- データ匿名化：分析用データの匿名化
- データ削除：退会時の完全削除

### 5.4 脆弱性対策

#### 5.4.1 Webアプリケーション脆弱性
- SQLインジェクション：ORMによるパラメータ化クエリ
- XSS（Cross-Site Scripting）：出力時サニタイズ
- CSRF（Cross-Site Request Forgery）：CSRFトークン
- セッション固定攻撃：セッションID再生成

#### 5.4.2 入力値検証
- フロントエンド検証：React Hook Form + Yup
- バックエンド検証：Pydantic による型安全性
- ファイルアップロード：拡張子・MIMEタイプチェック
- SQLパラメータ：SQLAlchemy ORM使用

### 5.5 ログ・監査要件
- アクセスログ：全HTTP リクエスト記録
- 操作ログ：データ登録・更新・削除の記録
- 認証ログ：ログイン・ログアウト・認証失敗
- エラーログ：システムエラー・例外の詳細記録
- ログ保存期間：1年間

## 6. ユーザビリティ要件

### 6.1 レスポンシブデザイン

#### 6.1.1 対応デバイス
- デスクトップ：1920×1080以上（主要対象）
- ラップトップ：1366×768以上
- モバイル：375×667以上（iPhone SE以上）
- タブレット：対象外（要件から除外）

#### 6.1.2 ブレイクポイント
- Mobile：〜767px
- Desktop：768px〜

#### 6.1.3 レスポンシブ要件
- フルード レイアウト：コンテンツの自動調整
- タッチ操作対応：44px以上のタップターゲット
- 横画面対応：モバイル横向き時の表示最適化

### 6.2 ユーザーインターフェース

#### 6.2.1 デザインシステム
- 適用方式：100% Atomic Design
- カラーパレット：防災グリーン & 信頼ブルー
- コンポーネント：共通UIコンポーネント
- 一貫性：全画面での統一されたUI/UX

#### 6.2.2 ナビゲーション
- パンくずリスト：3階層以上のページ
- サイドバー：主要機能への直接アクセス
- 検索機能：グローバル検索ボックス
- モバイル：ハンバーガーメニュー

#### 6.2.3 フォーム設計
- 入力支援：プレースホルダー・ヘルプテキスト
- バリデーション：リアルタイム入力チェック
- エラー表示：明確なエラーメッセージ
- 自動保存：下書き機能（重要データ）

### 6.3 アクセシビリティ要件
- 準拠レベル：WCAG 2.1 Level AA
- キーボード操作：全機能のキーボードアクセス
- スクリーンリーダー：ARIA属性の適切な設定
- コントラスト比：4.5:1以上

## 7. 互換性要件

### 7.1 ブラウザ対応

#### 7.1.1 対応ブラウザ
| ブラウザ | バージョン | 優先度 |
|----------|------------|-------|
| Google Chrome | 最新版 | 高 |
| Mozilla Firefox | 最新版 | 高 |
| Safari | 最新版 | 中 |
| Microsoft Edge | 最新版 | 中 |

#### 7.1.2 非対応ブラウザ
- Internet Explorer（全バージョン）
- 古いブラウザ（2年以上前のバージョン）

### 7.2 オペレーティングシステム
- Windows 10/11
- macOS 10.15以降
- Linux（Ubuntu 20.04以降）
- iOS 14以降（Safari）
- Android 10以降（Chrome）

### 7.3 データ互換性

#### 7.3.1 インポート・エクスポート
- Excel：.xlsx形式（Microsoft Excel 2016以降）
- CSV：UTF-8エンコーディング
- JSON：標準JSON形式
- PDF：出力のみ（レポート機能）

#### 7.3.2 外部API
- OpenAI API：GPT-4以降
- Google Maps API：最新版
- 郵便番号API：日本郵便API

## 8. 保守性要件

### 8.1 モニタリング要件

#### 8.1.1 システム監視
- リソース監視：CPU、メモリ、ディスク使用率
- パフォーマンス監視：レスポンス時間、スループット
- エラー監視：アプリケーションエラー、HTTPエラー
- 外部API監視：OpenAI API、Google Maps API応答時間

#### 8.1.2 アラート設定
- CPU使用率：80%以上で警告、90%以上で重大
- メモリ使用率：80%以上で警告、90%以上で重大
- レスポンス時間：3秒以上で警告、5秒以上で重大
- エラー率：5%以上で警告、10%以上で重大

### 8.2 ログ出力要件

#### 8.2.1 ログレベル
- DEBUG：開発環境のみ
- INFO：一般的な動作ログ
- WARNING：注意が必要な状況
- ERROR：エラー発生時
- CRITICAL：システム停止レベル

#### 8.2.2 ログフォーマット
```
[TIMESTAMP] [LEVEL] [MODULE] [USER_ID] MESSAGE
例：2025-09-07T10:30:00.123Z INFO auth user123 User login successful
```

### 8.3 テスト要件

#### 8.3.1 自動テスト
- 単体テスト：カバレッジ80%以上
- 結合テスト：主要機能100%
- E2Eテスト：クリティカルパス100%
- パフォーマンステスト：月1回実行

#### 8.3.2 品質指標
- バグ発生率：月間5件以下
- テスト実行時間：30分以内
- デプロイ成功率：95%以上

## 9. 拡張性要件

### 9.1 データ拡張性
- 会場データ：5年後1000件まで対応
- ユーザー数：20名まで拡張可能
- データベース：PostgreSQL移行時のスケールアップ

### 9.2 機能拡張性
- 新機能追加：モジュラー設計による追加容易性
- API拡張：RESTful API設計
- 外部システム連携：APIファーストアプローチ

### 9.3 インフラ拡張性
- Replit：現在の要件に最適化
- AWS移行：将来のスケールアウト対応
- CDN：静的リソースの配信最適化（将来実装）

## 10. 制約事項・前提条件

### 10.1 技術的制約
- Replitプラットフォームの制約に依存
- OpenAI API利用料制限
- 同時接続数の物理的制約

### 10.2 運用制約
- 平日営業時間内での運用が前提
- IT専任担当者不在での運用
- 予算制約による機能優先度

### 10.3 法的制約
- 個人情報保護法の遵守
- 会場運営者との利用許諾
- オープンソースライセンス遵守

## 11. 移行要件

### 11.1 段階的移行

#### 11.1.1 フェーズ1移行（JSONプロトタイプ）
- 移行時間：2時間以内
- データ準備：ExcelからJSONへの変換
- 動作確認：基本機能の検証

#### 11.1.2 フェーズ2移行（バックエンド統合）
- 移行時間：4時間以内
- データ移行：JSONからSQLiteへ
- 機能テスト：全機能の統合テスト

#### 11.1.3 フェーズ3移行（本番環境）
- 移行時間：6時間以内
- データ移行：SQLiteからPostgreSQLへ
- 本番リリース：段階的リリース

### 11.2 ロールバック要件
- ロールバック時間：1時間以内
- データ整合性：移行前状態への完全復元
- ダウンタイム：最小限（15分以内）

## 12. 品質管理要件

### 12.1 品質指標

#### 12.1.1 可用性指標
- システム稼働率：99.0%以上
- 平均故障間隔（MTBF）：30日以上
- 平均復旧時間（MTTR）：4時間以内

#### 12.1.2 パフォーマンス指標
- ページロード時間：3秒以内
- API応答時間：1秒以内
- データベースクエリ：100ms以内

#### 12.1.3 品質指標
- 欠陥密度：1000行あたり1件以下
- コードカバレッジ：80%以上
- 顧客満足度：80%以上

### 12.2 品質保证プロセス
- コードレビュー：全コミット必須
- 自動テスト：CI/CDパイプライン組み込み
- セキュリティ監査：月1回実施
- パフォーマンステスト：リリース前必須

## 13. 用語定義

| 用語 | 定義 |
|------|------|
| 非機能要件 | 機能以外のシステム品質特性に関する要件 |
| SLA | Service Level Agreement（サービスレベル合意） |
| レスポンス時間 | リクエスト送信から応答受信までの時間 |
| スループット | 単位時間あたりの処理量 |
| 稼働率 | システムが正常に動作している時間の割合 |
| MTBF | Mean Time Between Failures（平均故障間隔） |
| MTTR | Mean Time To Repair（平均復旧時間） |
| RPO | Recovery Point Objective（目標復旧地点） |
| RTO | Recovery Time Objective（目標復旧時間） |

## 14. 改訂履歴

| 版 | 日付 | 作成者 | 改訂内容 |
|----|------|--------|----------|
| 1.0 | 2025-09-07 | システム設計チーム | 初版作成 |